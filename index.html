<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Visualisasi Lapisan Bumi - WebGL</title>

        <style>
        body { 
            margin: 0; 
            overflow: hidden;
            background-color: #ffffff;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.08) 1px, transparent 1px);
            background-size: 55px 55px;
            background-position: center center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        canvas { display: block; }

        #main-title {
            position: absolute;
            top: 30px; left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 28px;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 0 2px 10px rgba(0,0,0,0.7);
            pointer-events: none; 
            z-index: 100;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1 );
        }




        
        #ui-container {
            position: absolute; 
            top: 20px; left: 20px;
            display: flex; 
            flex-direction: column; 
            gap: 10px;
            z-index: 100;
            width: 160px;
        }

        button {
            padding: 10px 15px; 
            font-size: 14px;
            background: rgba(30, 30, 30, 0.6);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 6px;
            color: #ddd; 
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.2s ease;
            text-align: left;
        }
        button:hover {
            background: rgba(255,255,255, 0.9); 
            color: #000;
            border-color: white;
        }

        .zoom-group {
            display: flex;
            gap: 5px;
        }
        .zoom-group button {
            flex: 1; 
            text-align: center;
            font-size: 18px;
            font-weight: bold;
        }

        #info-label {
            position: absolute; 
            display: none;
            background: rgba(0, 0, 0, 0.8);
            color: white; 
            padding: 8px 12px;
            border-radius: 4px;
            pointer-events: none; 
            font-size: 14px;
            white-space: nowrap;
            z-index: 101;
            border: 1px solid rgba(255,255,255,0.2);
        }
        #description-box {
            position: absolute;
            right: 20px;
            top: 100px;
            width: 260px;
            padding: 15px;
            color: white;

            background: rgba(0,0,0,0.65);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
            backdrop-filter: blur(6px);

            display: none;
            z-index: 130;
            position: absolute; 
        }

        #close-desc {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 14px;
            cursor: pointer;
            color: #aaa;
            transition: color 0.2s;
        }

        #close-desc:hover {
            color: white;
        }

        </style>
    </head>

    <div id="description-box">
        <span id="close-desc">❌</span> <h2 id="desc-title"></h2>
        <p id="desc-text"></p>
    </div>

    <body>

        <div id="main-title">Visualisasi Lapisan Bumi</div>

        <div id="ui-container">
            <button id="toggle-transparency">Buat Transparan</button>
            <button id="toggle-clipping">Toggle Irisan</button>
            
            <div class="zoom-group">
                <button id="zoom-in" title="Zoom In">+</button>
                <button id="zoom-out" title="Zoom Out">−</button>
            </div>
        </div>

        <div id="info-label"></div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
    import * as THREE from "three";
    import { OrbitControls } from "three/addons/controls/OrbitControls.js";

    // === Variabel ===
    let isTransparent = false;
    let isClipped = false;
    let isHoveringUI = false;

    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    const mousePos = { x: 0, y: 0 };
    const label = document.getElementById("info-label");

    // deskripsi scene
    const layerDescriptions = {
        "Crust (Kerak Bumi)": 
            "Kerak adalah lapisan terluar Bumi, terdiri dari batuan padat. Ketebalannya bervariasi antara 5–70 km.",
        "Mantle (Mantel)": 
            "Mantel adalah lapisan tebal yang terdiri dari batuan semi-padat berperilaku plastis. Pada mantel terjadi pergerakan konveksi.",
        "Outer Core (Inti Luar)": 
            "Inti Luar adalah lapisan logam cair (nikel dan besi). Gerakannya menghasilkan medan magnet Bumi.",
        "Inner Core (Inti Dalam)": 
            "Inti Dalam adalah bola logam padat dengan suhu mencapai 5000°C. Tekanannya sangat besar sehingga besi tetap padat."
    };


    // === Scene ===
    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera(
        75, window.innerWidth / window.innerHeight, 0.1, 1000
    );
    camera.position.z = 12;

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setClearColor(0x000000, 0); 
    renderer.localClippingEnabled = false;
    document.body.appendChild(renderer.domElement);

    // === Controls ===
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.enablePan = false;
    controls.minDistance = 0.1; 
    controls.maxDistance = 40;

    // === Cahaya ===
    scene.add(new THREE.AmbientLight(0xffffff, 0.55));
    const sunLight = new THREE.DirectionalLight(0xffffff, 1.1);
    sunLight.position.set(6, 4, 6);
    scene.add(sunLight);

    const clipPlanes = [
        new THREE.Plane(new THREE.Vector3(1, 0, 0), 0),
        new THREE.Plane(new THREE.Vector3(0, -1, 0), 0),
    ];

    const texLoader = new THREE.TextureLoader();
    const crustTexture = texLoader.load("peta_kerak.png"); 
    const intiDalam = texLoader.load("inti_dalam.jpg");
    const intiLuar = texLoader.load("inti_luar.jpg");
    const mantelTexture = texLoader.load("mantel.jpg");

    // === Geometri ===
    const gInner  = new THREE.SphereGeometry(1.3, 64, 64);
    const gOuter  = new THREE.SphereGeometry(2.2, 64, 64);
    const gMantle = new THREE.SphereGeometry(3.0, 64, 64);
    const gCrust  = new THREE.SphereGeometry(3.3, 64, 64);

    // === Material ===
    const mInner = new THREE.MeshStandardMaterial({
        map: intiDalam,
        emissive: 0xffdd77, emissiveIntensity: 0.65,
        roughness: 0.35, metalness: 0.15,
        clippingPlanes: clipPlanes, side: THREE.DoubleSide
    });

    const mOuter = new THREE.MeshStandardMaterial({
        map: intiLuar,
        color: 0xffb347, opacity: 0.85, transparent: true,
        roughness: 0.45, metalness: 0.15,
        emissive: 0xff7f24, emissiveIntensity: 0.22,
        clippingPlanes: clipPlanes, side: THREE.DoubleSide
    });

    const mMantle = new THREE.MeshStandardMaterial({
        map: mantelTexture,
        color: 0xffa64d, roughness: 0.80, metalness: 0.05,
        emissive: 0xcc6600, emissiveIntensity: 0.15,
        opacity: 1.0, clippingPlanes: clipPlanes, side: THREE.DoubleSide
    });

    const mCrust = new THREE.MeshStandardMaterial({
        map: crustTexture,
        roughness: 0.70, metalness: 0.0,
        emissive: 0x222222, emissiveIntensity: 0.25,
        clippingPlanes: clipPlanes, side: THREE.DoubleSide
    });

    // === Mesh ===
    const inner  = new THREE.Mesh(gInner,  mInner);
    const outer  = new THREE.Mesh(gOuter,  mOuter);
    const mantle = new THREE.Mesh(gMantle, mMantle);
    const crust  = new THREE.Mesh(gCrust,  mCrust);

    inner.userData.name  = "Inner Core (Inti Dalam)";
    outer.userData.name  = "Outer Core (Inti Luar)";
    mantle.userData.name = "Mantle (Mantel)";
    crust.userData.name  = "Crust (Kerak Bumi)";

    scene.add(inner, outer, mantle, crust);
    const layers = [crust, mantle, outer, inner];

    // tutup deskripsi
    const descriptionBox = document.getElementById("description-box");
    document.getElementById("close-desc").onclick = () => {
        descriptionBox.style.display = "none";
    };
    // === UI LOGIC ===
    document.getElementById("toggle-transparency").onclick = () => {
        isTransparent = !isTransparent;
        mMantle.opacity = isTransparent ? 0.55 : 1.0;
        mMantle.transparent = isTransparent;
        mCrust.opacity = isTransparent ? 0.70 : 1.0;
        mCrust.transparent = isTransparent;
        document.getElementById("toggle-transparency").textContent =
            isTransparent ? "Buat Solid" : "Buat Transparan";
    };

    document.getElementById("toggle-clipping").onclick = () => {
        isClipped = !isClipped;
        renderer.localClippingEnabled = isClipped;
        document.getElementById("toggle-clipping").textContent =
            isClipped ? "Tampilkan Penuh" : "Toggle Irisan";
    };

    const zoomStep = 1.5;
    document.getElementById("zoom-in").onclick = () => {
        camera.position.z = Math.max(camera.position.z - zoomStep, controls.minDistance);
    };

    document.getElementById("zoom-out").onclick = () => {
        camera.position.z = Math.min(camera.position.z + zoomStep, controls.maxDistance);
    };


    // === Mouse Logic  ===
    window.addEventListener("mousemove", (e)=>{
        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        mousePos.x = e.clientX;
        mousePos.y = e.clientY;

        if (e.target.tagName !== 'CANVAS') {
            isHoveringUI = true;
            label.style.display = 'none';
        } else {
            isHoveringUI = false;
        }
    });
    window.addEventListener("click", () => {
        if (isHoveringUI) return;
        
        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(layers);

        if (intersects.length > 0) {
             const obj = intersects[0].object;
             const title = obj.userData.name;
             const desc = layerDescriptions[title] || "Tidak ada deskripsi.";
            
            // description-box ditampilkan
             descriptionBox.style.display = "block"; 
             document.getElementById("desc-title").textContent = title;
             document.getElementById("desc-text").textContent = desc;
        }
    });


    function checkHover(){
        if (isHoveringUI) return;

        raycaster.setFromCamera(mouse, camera);
        const intersects = raycaster.intersectObjects(layers);
        
        let foundObj = null;
        for (let i = 0; i < intersects.length; i++) {
            const hit = intersects[i];
            const obj = hit.object;

            if (isClipped) {
                let isVisible = true;
                for (const plane of clipPlanes) {
                    if (plane.distanceToPoint(hit.point) < 0) {
                        isVisible = false;
                        break;
                    }
                }
                if (!isVisible) continue;
            }
            foundObj = obj;
            break; 
        }

        if (foundObj) {
            label.style.display = "block";
            label.textContent = foundObj.userData.name;
            label.style.left = mousePos.x + 12 + "px";
            label.style.top  = mousePos.y + 12 + "px";
        } else {
            label.style.display = "none";
        }
    }

    window.addEventListener("resize", ()=>{
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    function animate(){
        requestAnimationFrame(animate);
        const speed = 0.002; 
        inner.rotation.y  += speed;
        outer.rotation.y  += speed;
        mantle.rotation.y += speed;
        crust.rotation.y  += speed;

        controls.update();
        checkHover();
        renderer.render(scene, camera);
    }

    animate();
    </script>

    </body>
</html>